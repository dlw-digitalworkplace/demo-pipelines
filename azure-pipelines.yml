# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

pool:
  vmImage: ubuntu-latest

variables:
  buildConfiguration: 'Release'

stages:
  - stage: build_web_api
    displayName: Build web api
    jobs:
      - job: build_web_api
        displayName: Building web api
        steps:
          - task: DotNetCoreCLI@2
            displayName: Restoring packages
            inputs:
             command: 'restore'
             projects: 'Pipelines.Server/**/*.csproj'
          - task: DotNetCoreCLI@2
            displayName: Building csproj
            inputs:
             command: 'build'
             projects: 'Pipelines.Server/**/*.csproj'
             arguments: '--configuration $(buildConfiguration)'
      - job: publish_web_api
        displayName: Publish web api
        steps:
        - task: DotNetCoreCLI@2
          inputs:
            command: publish
            publishWebProjects: True
            arguments: '--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory)'
            zipAfterPublish: True

        # this code takes all the files in $(Build.ArtifactStagingDirectory) and uploads them as an artifact of your build.
        - task: PublishPipelineArtifact@1
          inputs:
            targetPath: '$(Build.ArtifactStagingDirectory)' 
            artifactName: '.NET Core web api'